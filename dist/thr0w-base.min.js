!function(){"use strict";function t(t){f=t}function e(t,e,n){function a(){function t(t){function n(t){27===t.keyCode&&h()}t?h():(window.localStorage.setItem("thr0w_channel",u),document.addEventListener("keydown",n),e())}s(u,t,n)}function c(){function e(t){t.preventDefault(),i()}function n(t){t.preventDefault(),o.style.display="none",u=parseInt(o.querySelector("#thr0w_base_connect__connect__channel").value),(!u||0>u)&&(u=0),a()}var o=document.createElement("div");o.id="thr0w_base_connect",o.innerHTML=['<form id="thr0w_base_connect__connect">','<input id="thr0w_base_connect__connect__channel" type="number" />','<button type="submit">Connect</button>',"</form>",'<button id="thr0w_base_connect__logout">Logout</button>'].join("\n"),o.querySelector("#thr0w_base_connect__logout").addEventListener("mousedown",e),o.querySelector("#thr0w_base_connect__logout").addEventListener("touchstart",e),o.querySelector("#thr0w_base_connect__connect").addEventListener("submit",n),t.appendChild(o)}function l(){function e(t){function e(t){t||(n.style.display="none",c())}t.preventDefault();var i=n.querySelector("#thr0w_base_login__username").value,r=n.querySelector("#thr0w_base_login__password").value;i&&r&&o(i,r,e)}var n=document.createElement("form");n.id="thr0w_base_login",n.innerHTML=['<input id="thr0w_base_login__username" type="text" placeholder="Username">','<input id="thr0w_base_login__password" type="password" placeholder="Password">','<button type="submit">Login</button>'].join("\n"),n.addEventListener("submit",e),t.appendChild(n)}if(void 0===t||"object"!=typeof t)throw 400;if(void 0===e||"function"!=typeof e)throw 400;if(void 0===n||"function"!=typeof n)throw 400;var u=window.localStorage.getItem("thr0w_channel");null!==u?(u=parseInt(u),a()):r()?c():l()}function n(){return p}function o(t,e,n){function o(){if(4===a.readyState){if(200===a.status){var t;try{t=JSON.parse(a.responseText).token}catch(e){return n(500)}return t?(window.localStorage.setItem("thr0w_token",t),n(null)):n(500)}return n(a.status?a.status:500)}}if(void 0===t||"string"!=typeof t)throw 400;if(void 0===e||"string"!=typeof e)throw 400;if(void 0===n||"function"!=typeof n)throw 400;var i=f+":3000/api/login",r="username="+t+"&password="+e,a=new XMLHttpRequest;a.open("POST",i,!0),a.setRequestHeader("Content-type","application/x-www-form-urlencoded"),a.onreadystatechange=o,a.send(r)}function i(){window.localStorage.removeItem("thr0w_token"),h()}function r(){return null!==window.localStorage.getItem("thr0w_token")}function a(t,e){var n=f+":3000/api/thr0w",o=window.localStorage.getItem("thr0w_token"),i=new XMLHttpRequest;i.open("POST",n,!0),i.setRequestHeader("Authorization","bearer "+o),i.setRequestHeader("Content-type","application/json"),i.send(JSON.stringify({channels:t,message:e}))}function s(t,e,n){function o(){w.disconnect(),e(500)}function i(){function t(){h()}window.clearTimeout(s),w.on("message",n),w.on("duplicate",t),e(null)}var a,s;if(!w){if(!r())throw 400;if(void 0===t||"number"!=typeof t)throw 400;if(void 0===e||"function"!=typeof e)throw 400;if(void 0===n||"function"!=typeof n)throw 400;p=t,a=window.localStorage.getItem("thr0w_token"),s=window.setTimeout(o,5e3),w=window.io(f+":3001"),w.on("authenticated",i),w.emit("authenticate",JSON.stringify({token:a,channel:p}))}}function c(t,e){if(!w)throw 400;if(void 0===t||!Array.isArray(t))throw 400;0!==t.length&&w.emit("thr0w",JSON.stringify({channels:t,message:e}))}function l(t,e,n){function o(){return t}function i(){return e}function r(){return n}function a(){return e.offsetWidth}function s(){return e.offsetHeight}function c(){return 1}if(!w)throw 400;if(void 0===t||"object"!=typeof t)throw 400;if(void 0===e||"object"!=typeof e)throw 400;if(void 0===n||!Array.isArray(n))throw 400;for(var l=0,u=0,d=0;d<n.length;d++)for(var h=0;h<n[d].length;h++)p===n[d][h]&&(l=h,u=d);e.style.left="-"+l*t.clientWidth+"px",e.style.top="-"+u*t.clientHeight+"px",this.getFrame=o,this.getContent=i,this.getMatrix=r,this.getWidth=a,this.getHeight=s,this.getRowScale=c}function u(t,e,n,o){function i(t){t.preventDefault()}function r(){return t}function a(){return e}function s(){return n}function c(){return y}function l(){return _}function u(){return o[g].scale}if(!w)throw 400;if(void 0===t||"object"!=typeof t)throw 400;if(void 0===e||"object"!=typeof e)throw 400;if(void 0===n||!Array.isArray(n))throw 400;if(void 0===o||!Array.isArray(o))throw 400;var d,h,f=0,g=0,y=0,_=0,v=0,m=0;for(d=0;d<n.length;d++)for(o[d].spacing=o[d].spacing?o[d].spacing:0,o[d].scale=o[d].scale?o[d].scale:1,o[d].padding=o[d].padding?o[d].padding:0,o[d].margin=o[d].margin?o[d].margin:0,y=Math.max(o[d].scale*o[d].width*n[d].length+2*o[d].padding*o[d].scale+o[d].spacing*(n[d].length-1)*o[d].scale,y),_+=o[d].scale*o[d].height+o[d].scale*o[d].margin,h=0;h<n[d].length;h++)p===n[d][h]&&(f=h,g=d);for(t.style.width=o[g].scale*o[g].width+"px",t.style.height=o[g].scale*o[g].height+"px",t.style.left=o[g].width*(1-o[g].scale)/2+"px",t.style.top=o[g].height*(1-o[g].scale)/2+"px",t.style.transform="scale("+1/o[g].scale+", "+1/o[g].scale+")",e.style.width=y+"px",e.style.height=_+"px",d=0;g>d;d++)m+=o[d].scale*o[d].height+o[d].scale*o[d].margin;var b=o[g].padding*o[g].scale,S=f*o[g].scale*o[g].width,x=f*o[g].spacing*o[g].scale;v=b+S+x,e.style.left="-"+v+"px",e.style.top="-"+m+"px",t.addEventListener("touchstart",i),this.getFrame=r,this.getContent=a,this.getMatrix=s,this.getWidth=c,this.getHeight=l,this.getRowScale=u}function d(t,e,n,o){function i(){f||(h||(h=!0,g=!0,c(d,{thr0w:{type:"sync",_id:e,lock:!0}})),c(d,{thr0w:{type:"sync",_id:e,message:n()}}))}function r(){f||(h=!1,c(d,{thr0w:{type:"sync",_id:e,unlock:!0}}))}function a(t){var i=t.message;if(void 0!==i&&t.source!==p){var r=i.thr0w;if(void 0!==r&&"sync"===r.type&&r._id===e){if(r.hello)return h&&c(d,{thr0w:{type:"sync",_id:e,lock:!0}}),void(g&&c(d,{thr0w:{type:"sync",_id:e,message:n()}}));if(!h)return r.lock&&!h?(g=!1,f=!0,void(_.style.visibility="visible")):r.unlock&&!h?(f=!1,void(_.style.visibility="hidden")):void o(r.message)}}}function s(){w.off("message",a)}if(void 0===t||"object"!=typeof t)throw 400;if(void 0===e||"string"!=typeof e)throw 400;if(void 0===n||"function"!=typeof n)throw 400;if(void 0===o||"function"!=typeof o)throw 400;var l,u,d=[],h=!1,f=!1,g=!1,y=t.getMatrix(),_=document.createElement("div");_.classList.add("thr0w_base_cover"),_.style.visibility="hidden",t.getFrame().appendChild(_);for(var v=0;v<y.length;v++)for(var m=0;m<y[v].length;m++)d.push(y[v][m]),p===y[v][m]&&(l=m,u=v);w.on("message",a),c(d,{thr0w:{type:"sync",_id:e,hello:!0}}),this.update=i,this.idle=r,this.destroy=s}function h(){window.localStorage.removeItem("thr0w_channel",p),window.location.reload()}var f,w=null,p=null,g={};g.setBase=t,g.addAdminTools=e,g.getChannel=n,g.login=o,g.logout=i,g.authenticated=r,g.thr0w=a,g.connect=s,g.thr0wChannel=c,g.Grid=l,g.FlexGrid=u,g.Sync=d,window.thr0w=g}();