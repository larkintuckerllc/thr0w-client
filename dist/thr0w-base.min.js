!function(){"use strict";function t(t){f=t}function e(t,e,n){function a(){function t(t){function n(t){27===t.keyCode&&u()}t?u():(window.localStorage.setItem("thr0w_channel",h),document.addEventListener("keydown",n),e())}s(h,t,n)}function c(){function e(){o()}function n(t){t.preventDefault(),i.style.display="none",h=parseInt(i.querySelector("#thr0w_base_connect__connect__channel").value),(!h||0>h)&&(h=0),a()}var i=document.createElement("div");i.id="thr0w_base_connect",i.innerHTML=['<form id="thr0w_base_connect__connect">','<input id="thr0w_base_connect__connect__channel" type="number" />','<button type="submit">Connect</button>',"</form>",'<button id="thr0w_base_connect__logout">Logout</button>'].join("\n"),i.querySelector("#thr0w_base_connect__logout").addEventListener("click",e),i.querySelector("#thr0w_base_connect__connect").addEventListener("submit",n),t.appendChild(i)}function l(){function e(t){function e(t){t||(n.style.display="none",c())}t.preventDefault();var o=n.querySelector("#thr0w_base_login__username").value,r=n.querySelector("#thr0w_base_login__password").value;o&&r&&i(o,r,e)}var n=document.createElement("form");n.id="thr0w_base_login",n.innerHTML=['<input id="thr0w_base_login__username" type="text" placeholder="Username">','<input id="thr0w_base_login__password" type="password" placeholder="Password">','<button type="submit">Login</button>'].join("\n"),n.addEventListener("submit",e),t.appendChild(n)}if(void 0===t||"object"!=typeof t)throw 400;if(void 0===e||"function"!=typeof e)throw 400;if(void 0===n||"function"!=typeof n)throw 400;var h=window.localStorage.getItem("thr0w_channel");null!==h?(h=parseInt(h),a()):r()?c():l()}function n(){return p}function i(t,e,n){function i(){if(4===a.readyState){if(200===a.status){var t;try{t=JSON.parse(a.responseText).token}catch(e){return n(500)}return t?(window.localStorage.setItem("thr0w_token",t),n(null)):n(500)}return n(a.status?a.status:500)}}if(void 0===t||"string"!=typeof t)throw 400;if(void 0===e||"string"!=typeof e)throw 400;if(void 0===n||"function"!=typeof n)throw 400;var o=f+":3000/api/login",r="username="+t+"&password="+e,a=new XMLHttpRequest;a.open("POST",o,!0),a.setRequestHeader("Content-type","application/x-www-form-urlencoded"),a.onreadystatechange=i,a.send(r)}function o(){window.localStorage.removeItem("thr0w_token"),u()}function r(){return null!==window.localStorage.getItem("thr0w_token")}function a(t,e){var n=f+":3000/api/thr0w",i=window.localStorage.getItem("thr0w_token"),o=new XMLHttpRequest;o.open("POST",n,!0),o.setRequestHeader("Authorization","bearer "+i),o.setRequestHeader("Content-type","application/json"),o.send(JSON.stringify({channels:t,message:e}))}function s(t,e,n){function i(){g.disconnect(),e(500)}function o(){function t(){u()}window.clearTimeout(s),g.on("message",n),g.on("duplicate",t),e(null)}var a,s;if(!g){if(!r())throw 400;if(void 0===t||"number"!=typeof t)throw 400;if(void 0===e||"function"!=typeof e)throw 400;if(void 0===n||"function"!=typeof n)throw 400;p=t,a=window.localStorage.getItem("thr0w_token"),s=window.setTimeout(i,5e3),g=w(f+":3001"),g.on("authenticated",o),g.emit("authenticate",JSON.stringify({token:a,channel:p}))}}function c(t,e){if(!g)throw 400;if(void 0===t||!Array.isArray(t))throw 400;0!==t.length&&g.emit("thr0w",JSON.stringify({channels:t,message:e}))}function l(t,e,n){function i(){return t}function o(){return e}function r(){return n}function a(){return e.offsetWidth}function s(){return e.offsetHeight}function c(){return 1}function l(e){if(void 0===e||!Array.isArray(e)||2!==e.length||void 0===e[0]||void 0===e[1]||"number"!=typeof e[0]||"number"!=typeof e[1])throw 400;return[e[0]+d*t.clientWidth,e[1]+u*t.clientHeight]}function h(){return[d*t.clientWidth,u*t.clientHeight,d*t.clientWidth+t.clientWidth,u*t.clientHeight+t.clientHeight]}if(!g)throw 400;if(void 0===t||"object"!=typeof t)throw 400;if(void 0===e||"object"!=typeof e)throw 400;if(void 0===n||!Array.isArray(n))throw 400;for(var d=0,u=0,f=0;f<n.length;f++)for(var w=0;w<n[f].length;w++)p===n[f][w]&&(d=w,u=f);e.style.left="-"+d*t.clientWidth+"px",e.style.top="-"+u*t.clientHeight+"px",this.getFrame=i,this.getContent=o,this.getMatrix=r,this.getWidth=a,this.getHeight=s,this.getRowScale=c,this.frameXYToContentXY=l,this.getVisibleBounds=h}function h(t,e,n,i){function o(){return t}function r(){return e}function a(){return n}function s(){return v}function c(){return _}function l(){return i[y].scale}function h(t){if(void 0===t||!Array.isArray(t)||2!==t.length||void 0===t[0]||void 0===t[1]||"number"!=typeof t[0]||"number"!=typeof t[1])throw 400;return[t[0]*i[y].scale+m,t[1]*i[y].scale+b]}function d(){return[m,b,m+t.clientWidth,b+t.clientHeight]}if(!g)throw 400;if(void 0===t||"object"!=typeof t)throw 400;if(void 0===e||"object"!=typeof e)throw 400;if(void 0===n||!Array.isArray(n))throw 400;if(void 0===i||!Array.isArray(i))throw 400;var u,f,w=0,y=0,v=0,_=0,m=0,b=0;for(u=0;u<n.length;u++)for(i[u].spacing=i[u].spacing?i[u].spacing:0,i[u].scale=i[u].scale?i[u].scale:1,i[u].padding=i[u].padding?i[u].padding:0,i[u].margin=i[u].margin?i[u].margin:0,v=Math.max(i[u].scale*i[u].width*n[u].length+2*i[u].padding*i[u].scale+i[u].spacing*(n[u].length-1)*i[u].scale,v),_+=i[u].scale*i[u].height+i[u].scale*i[u].margin,f=0;f<n[u].length;f++)p===n[u][f]&&(w=f,y=u);for(t.style.width=i[y].scale*i[y].width+"px",t.style.height=i[y].scale*i[y].height+"px",t.style.transform="translate("+i[y].width*(1-i[y].scale)/2+"px,"+i[y].height*(1-i[y].scale)/2+"px) scale("+1/i[y].scale+", "+1/i[y].scale+")",e.style.width=v+"px",e.style.height=_+"px",u=0;y>u;u++)b+=i[u].scale*i[u].height+i[u].scale*i[u].margin;var S=i[y].padding*i[y].scale,x=w*i[y].scale*i[y].width,H=w*i[y].spacing*i[y].scale;m=S+x+H,e.style.left="-"+m+"px",e.style.top="-"+b+"px",this.getFrame=o,this.getContent=r,this.getMatrix=a,this.getWidth=s,this.getHeight=c,this.getRowScale=l,this.frameXYToContentXY=h,this.getVisibleBounds=d}function d(t,e,n,i,o){function r(){w||(f||(f=!0,y=!0,o&&(_.style.visibility="visible"),c(u,{thr0w:{type:"sync",_id:e,lock:!0}})),c(u,{thr0w:{type:"sync",_id:e,message:n()}}))}function a(){w||(f=!1,o&&(_.style.visibility="hidden"),c(u,{thr0w:{type:"sync",_id:e,unlock:!0}}))}function s(t){var o=t.message;if(void 0!==o&&t.source!==p){var r=o.thr0w;if(void 0!==r&&"sync"===r.type&&r._id===e){if(r.hello)return f&&c(u,{thr0w:{type:"sync",_id:e,lock:!0}}),void(y&&c(u,{thr0w:{type:"sync",_id:e,message:n()}}));if(!f)return r.lock&&!f?(y=!1,w=!0,void(_.style.visibility="visible")):r.unlock&&!f?(w=!1,void(_.style.visibility="hidden")):void i(r.message)}}}function l(){m.removeChild(_),g.off("message",s)}if(void 0===t||"object"!=typeof t)throw 400;if(void 0===e||"string"!=typeof e)throw 400;if(void 0===n||"function"!=typeof n)throw 400;if(void 0===i||"function"!=typeof i)throw 400;if(void 0!==o&&"boolean"!=typeof o)throw 400;var h,d,u=[],f=!1,w=!1,y=!1,v=t.getMatrix(),_=document.createElement("div"),m=t.getFrame();_.classList.add("thr0w_base_cover"),_.style.visibility="hidden",m.appendChild(_);for(var b=0;b<v.length;b++)for(var S=0;S<v[b].length;S++)u.push(v[b][S]),p===v[b][S]&&(h=S,d=b);g.on("message",s),c(u,{thr0w:{type:"sync",_id:e,hello:!0}}),this.update=r,this.idle=a,this.destroy=l}function u(){window.localStorage.removeItem("thr0w_channel",p),window.location.reload()}var f,w=window.io,g=null,p=null,y={};y.setBase=t,y.addAdminTools=e,y.getChannel=n,y.login=i,y.logout=o,y.authenticated=r,y.thr0w=a,y.connect=s,y.thr0wChannel=c,y.Grid=l,y.FlexGrid=h,y.Sync=d,window.thr0w=y}();