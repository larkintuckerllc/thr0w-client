!function(){"use strict";function t(t){_=t}function e(t,e){function n(t){function n(t){t||(o.style.display="none",e())}t.preventDefault();var r=o.querySelector("#thr0w_base_login__username").value,a=o.querySelector("#thr0w_base_login__password").value;r&&a&&i(r,a,n)}if(void 0===t||"object"!=typeof t)throw 400;if(void 0===e||"function"!=typeof e)throw 400;if(a())return e();var o=document.createElement("form");o.id="thr0w_base_login",o.innerHTML=['<input id="thr0w_base_login__username" type="text" placeholder="Username">','<input id="thr0w_base_login__password" type="password" placeholder="Password">','<button type="submit">Login</button>'].join("\n"),o.addEventListener("submit",n),t.appendChild(o)}function n(t,n,o){function i(){function t(t){function e(t){27===t.keyCode&&v()}t?window.setTimeout(y,1e4):(document.addEventListener("keydown",e),n())}window.localStorage.setItem("thr0w_channel",c),d(c,t,o)}function s(){function e(){r()}function n(t){t.preventDefault(),o.style.display="none",c=parseInt(o.querySelector("#thr0w_base_connect__connect__channel").value),(!c||c<0)&&(c=0),i()}var o=document.createElement("div");o.id="thr0w_base_connect",o.innerHTML=['<form id="thr0w_base_connect__connect">','<input id="thr0w_base_connect__connect__channel" type="number" />','<button type="submit">Connect</button>',"</form>",'<button id="thr0w_base_connect__logout">Logout</button>'].join("\n"),o.querySelector("#thr0w_base_connect__logout").addEventListener("click",e),o.querySelector("#thr0w_base_connect__connect").addEventListener("submit",n),t.appendChild(o)}if(void 0===t||"object"!=typeof t)throw 400;if(void 0===n||"function"!=typeof n)throw 400;if(void 0===o||"function"!=typeof o)throw 400;var c=window.localStorage.getItem("thr0w_channel");null!==c?(c=parseInt(c),i()):a()?s():e(t,s)}function o(){return S}function i(t,e,n){function o(){if(4===a.readyState){if(200===a.status){var t;try{t=JSON.parse(a.responseText).token}catch(e){return n(500)}return t?(window.localStorage.setItem("thr0w_token",t),n(null)):n(500)}return n(a.status?a.status:500)}}if(void 0===t||"string"!=typeof t)throw 400;if(void 0===e||"string"!=typeof e)throw 400;if(void 0===n||"function"!=typeof n)throw 400;var i=_+":3000/api/login",r="username="+t+"&password="+e,a=new XMLHttpRequest;a.open("POST",i,!0),a.setRequestHeader("Content-type","application/x-www-form-urlencoded"),a.onreadystatechange=o,a.send(r)}function r(){window.localStorage.removeItem("thr0w_token"),window.location.reload()}function a(){return null!==window.localStorage.getItem("thr0w_token")}function s(){return window.localStorage.getItem("thr0w_token")}function c(t,e){function n(){if(4===i.readyState)return 200!==i.status?e(i.status?i.status:500):(window.localStorage.setItem("thr0w_token",t),e(null))}if(void 0===t||"string"!=typeof t)throw 400;if(void 0===e||"function"!=typeof e)throw 400;var o=_+":3000/api/valid",i=new XMLHttpRequest;i.open("POST",o,!0),i.setRequestHeader("Authorization","bearer "+t),i.setRequestHeader("Content-type","application/json"),i.onreadystatechange=n,i.send(JSON.stringify({}))}function l(t,e){var n=_+":3000/api/thr0w",o=window.localStorage.getItem("thr0w_token"),i=new XMLHttpRequest;i.open("POST",n,!0),i.setRequestHeader("Authorization","bearer "+o),i.setRequestHeader("Content-type","application/json"),i.send(JSON.stringify({channels:t,message:e}))}function d(t,e,n){function o(){b.disconnect(),e(500)}function i(){b.emit("authenticate",JSON.stringify({token:s,channel:S}))}function r(){l||(l=!0,window.clearTimeout(c),b.on("message",n),b.on("duplicate",y),e(null))}var s,c,l=!1;if(!b){if(!a())throw 400;if(void 0===t||"number"!=typeof t)throw 400;if(void 0===e||"function"!=typeof e)throw 400;if(void 0===n||"function"!=typeof n)throw 400;S=t,s=window.localStorage.getItem("thr0w_token"),c=window.setTimeout(o,5e3),b=m(_+":3001"),b.on("authenticated",r),b.on("reconnect",i),b.emit("authenticate",JSON.stringify({token:s,channel:S}))}}function f(t){if(!a())throw 400;if(null===S)throw 400;if(void 0===t||"function"!=typeof t)throw 400;b.on("message",t)}function u(t){if(!a())throw 400;if(null===S)throw 400;if(void 0===t||"function"!=typeof t)throw 400;b.off("message",t)}function h(t,e){if(!b)throw 400;if(void 0===t||!Array.isArray(t))throw 400;0!==t.length&&b.emit("thr0w",JSON.stringify({channels:t,message:e}))}function w(t,e,n){function o(){return t}function i(){return e}function r(){return n}function a(){return e.clientWidth}function s(){return e.clientHeight}function c(){return 1}function l(e){if(void 0===e||!Array.isArray(e)||2!==e.length||void 0===e[0]||void 0===e[1]||"number"!=typeof e[0]||"number"!=typeof e[1])throw 400;return[e[0]+d*t.clientWidth,e[1]+f*t.clientHeight]}if(!b)throw 400;if(void 0===t||"object"!=typeof t)throw 400;if(void 0===e||"object"!=typeof e)throw 400;if(void 0===n||!Array.isArray(n))throw 400;for(var d=0,f=0,u=0;u<n.length;u++)for(var h=0;h<n[u].length;h++)S===n[u][h]&&(d=h,f=u);e.style.left="-"+d*t.clientWidth+"px",e.style.top="-"+f*t.clientHeight+"px",this.getFrame=o,this.getContent=i,this.getMatrix=r,this.getWidth=a,this.getHeight=s,this.getRowScale=c,this.frameXYToContentXY=l}function g(t,e,n,o){function i(){return t}function r(){return e}function a(){return n}function s(){return g}function c(){return p}function l(){return o[w].scale}function d(t){if(void 0===t||!Array.isArray(t)||2!==t.length||void 0===t[0]||void 0===t[1]||"number"!=typeof t[0]||"number"!=typeof t[1])throw 400;return[t[0]*o[w].scale+y,t[1]*o[w].scale+v]}if(!b)throw 400;if(void 0===t||"object"!=typeof t)throw 400;if(void 0===e||"object"!=typeof e)throw 400;if(void 0===n||!Array.isArray(n))throw 400;if(void 0===o||!Array.isArray(o))throw 400;var f,u,h=0,w=0,g=0,p=0,y=0,v=0;for(f=0;f<n.length;f++)for(o[f].spacing=o[f].spacing?o[f].spacing:0,o[f].scale=o[f].scale?o[f].scale:1,o[f].padding=o[f].padding?o[f].padding:0,o[f].margin=o[f].margin?o[f].margin:0,g=Math.max(o[f].scale*o[f].width*n[f].length+2*o[f].padding*o[f].scale+o[f].spacing*(n[f].length-1)*o[f].scale,g),p+=o[f].scale*o[f].height+o[f].scale*o[f].margin,u=0;u<n[f].length;u++)S===n[f][u]&&(h=u,w=f);for(t.style.width=o[w].scale*o[w].width+"px",t.style.height=o[w].scale*o[w].height+"px",t.style.transform="translate("+o[w].width*(1-o[w].scale)/2+"px,"+o[w].height*(1-o[w].scale)/2+"px) scale("+1/o[w].scale+", "+1/o[w].scale+")",e.style.width=g+"px",e.style.height=p+"px",f=0;f<w;f++)v+=o[f].scale*o[f].height+o[f].scale*o[f].margin;var _=o[w].padding*o[w].scale,m=h*o[w].scale*o[w].width,k=h*o[w].spacing*o[w].scale;y=_+m+k,e.style.left="-"+y+"px",e.style.top="-"+v+"px",this.getFrame=i,this.getContent=r,this.getMatrix=a,this.getWidth=s,this.getHeight=c,this.getRowScale=l,this.frameXYToContentXY=d}function p(t,e,n,o,i){function r(){f||(d||(d=!0,u=!0,i&&(g.style.visibility="visible"),h(l,{thr0w:{type:"sync",_id:e,lock:!0}})),h(l,{thr0w:{type:"sync",_id:e,message:n()}}))}function a(){f||(d=!1,i&&(g.style.visibility="hidden"),h(l,{thr0w:{type:"sync",_id:e,unlock:!0}}))}function s(t){var i=t.message;if(void 0!==i&&t.source!==S){var r=i.thr0w;if(void 0!==r&&"sync"===r.type&&r._id===e){if(r.hello)return d&&h(l,{thr0w:{type:"sync",_id:e,lock:!0}}),void(u&&h(l,{thr0w:{type:"sync",_id:e,message:n()}}));if(!d)return r.lock&&!d?(u=!1,f=!0,void(g.style.visibility="visible")):r.unlock&&!d?(f=!1,void(g.style.visibility="hidden")):void o(r.message)}}}function c(){p.removeChild(g),b.off("message",s)}if(void 0===t||"object"!=typeof t)throw 400;if(void 0===e||"string"!=typeof e)throw 400;if(void 0===n||"function"!=typeof n)throw 400;if(void 0===o||"function"!=typeof o)throw 400;if(void 0!==i&&"boolean"!=typeof i)throw 400;var l=[],d=!1,f=!1,u=!1,w=t.getMatrix(),g=document.createElement("div"),p=t.getFrame();g.id="thr0w_base_cover--"+e,g.classList.add("thr0w_base_cover"),g.style.visibility="hidden",p.appendChild(g);for(var y=0;y<w.length;y++)for(var v=0;v<w[y].length;v++)l.push(w[y][v]);b.on("message",s),h(l,{thr0w:{type:"sync",_id:e,hello:!0}}),this.update=r,this.idle=a,this.destroy=c}function y(){window.location.reload()}function v(){window.localStorage.removeItem("thr0w_channel",S),window.location.reload()}var _,m=window.io,b=null,S=null,k={};k.setBase=t,k.addLoginTools=e,k.addAdminTools=n,k.getChannel=o,k.login=i,k.logout=r,k.authenticated=a,k.getToken=s,k.loginToken=c,k.thr0w=l,k.connect=d,k.onMessage=f,k.offMessage=u,k.thr0wChannel=h,k.Grid=w,k.FlexGrid=g,k.Sync=p,window.thr0w=k}();