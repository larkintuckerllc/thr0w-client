!function(){"use strict";function t(t){u=t}function e(t,e,n){function a(){function t(t){function n(t){27===t.keyCode&&(window.localStorage.removeItem("thr0w_channel",h),window.location.reload())}t?(window.localStorage.removeItem("thr0w_channel",h),window.location.reload()):(window.localStorage.setItem("thr0w_channel",h),document.addEventListener("keydown",n),e())}c(h,t,n)}function s(){function e(t){t.preventDefault(),n.style.display="none",h=parseInt(n.querySelector("#thr0w_base_connect__connect__channel").value),(!h||0>h)&&(h=0),a()}var n=document.createElement("div");n.id="thr0w_base_connect",n.innerHTML=['<form id="thr0w_base_connect__connect">','<input id="thr0w_base_connect__connect__channel" type="number" />','<button type="submit">Connect</button>',"</form>",'<button id="thr0w_base_connect__logout">Logout</button>'].join("\n"),n.querySelector("#thr0w_base_connect__logout").addEventListener("click",i),n.querySelector("#thr0w_base_connect__connect").addEventListener("submit",e),t.appendChild(n)}function l(){function e(t){function e(t){t||(n.style.display="none",s())}t.preventDefault();var i=n.querySelector("#thr0w_base_login__username").value,r=n.querySelector("#thr0w_base_login__password").value;i&&r&&o(i,r,e)}var n=document.createElement("form");n.id="thr0w_base_login",n.innerHTML=['<input id="thr0w_base_login__username" type="text" placeholder="Username">','<input id="thr0w_base_login__password" type="password" placeholder="Password">','<button type="submit">Login</button>'].join("\n"),n.addEventListener("submit",e),t.appendChild(n)}if(void 0===t||"object"!=typeof t)throw 400;if(void 0===e||"function"!=typeof e)throw 400;if(void 0===n||"function"!=typeof n)throw 400;var h=window.localStorage.getItem("thr0w_channel");null!==h?(h=parseInt(h),a()):r()?s():l()}function n(){return w}function o(t,e,n){function o(){if(4===a.readyState){if(200===a.status){var t;try{t=JSON.parse(a.responseText).token}catch(e){return n(500)}return t?(window.localStorage.setItem("thr0w_token",t),n(null)):n(500)}return n(a.status?a.status:500)}}if(void 0===t||"string"!=typeof t)throw 400;if(void 0===e||"string"!=typeof e)throw 400;if(void 0===n||"function"!=typeof n)throw 400;var i=u+":3000/api/login",r="username="+t+"&password="+e,a=new XMLHttpRequest;a.open("POST",i,!0),a.setRequestHeader("Content-type","application/x-www-form-urlencoded"),a.onreadystatechange=o,a.send(r)}function i(){window.localStorage.removeItem("thr0w_token"),window.location.reload()}function r(){return null!==window.localStorage.getItem("thr0w_token")}function a(t,e){var n=u+":3000/api/thr0w",o=window.localStorage.getItem("thr0w_token"),i=new XMLHttpRequest;i.open("POST",n,!0),i.setRequestHeader("Authorization","bearer "+o),i.setRequestHeader("Content-type","application/json"),i.send(JSON.stringify({channels:t,message:e}))}function c(t,e,n){function o(){f.disconnect(),e(500)}function i(){function t(){window.location.reload()}window.clearTimeout(c),f.on("message",n),f.on("duplicate",t),e(null)}var a,c;if(!f){if(!r())throw 400;if(void 0===t||"number"!=typeof t)throw 400;if(void 0===e||"function"!=typeof e)throw 400;if(void 0===n||"function"!=typeof n)throw 400;w=t,a=window.localStorage.getItem("thr0w_token"),c=window.setTimeout(o,5e3),f=window.io(u+":3001"),f.on("authenticated",i),f.emit("authenticate",JSON.stringify({token:a,channel:w}))}}function s(t,e){if(!f)throw 400;f.emit("thr0w",JSON.stringify({channels:t,message:e}))}function l(t,e,n){function o(){return t}function i(){return e}function r(){return n}function a(){return e.offsetWidth}function c(){return e.offsetHeight}if(!f)throw 400;if(void 0===t||"object"!=typeof t)throw 400;if(void 0===e||"object"!=typeof e)throw 400;if(void 0===n||!Array.isArray(n))throw 400;for(var s,l,h=0;h<n.length;h++)for(var d=0;d<n[h].length;d++)w===n[h][d]&&(s=d,l=h);e.style.left="-"+s*t.clientWidth+"px",e.style.top="-"+l*t.clientHeight+"px",this.getFrame=o,this.getContent=i,this.getMatrix=r,this.getWidth=a,this.getHeight=c}function h(t,e,n,o){function i(){return t}function r(){return e}function a(){return n}function c(){return y}function s(){return p}if(!f)throw 400;if(void 0===t||"object"!=typeof t)throw 400;if(void 0===e||"object"!=typeof e)throw 400;if(void 0===n||!Array.isArray(n))throw 400;if(void 0===o||!Array.isArray(o))throw 400;var l,h,d,u,y=0,p=0,g=0,_=0;for(l=0;l<n.length;l++)for(o[l].scale=o[l].scale?o[l].scale:1,y=Math.max(o[l].scale*o[l].width*n[l].length,y),p+=o[l].scale*o[l].height,h=0;h<n[l].length;h++)w===n[l][h]&&(d=h,u=l);for(t.style.width=o[u].scale*o[u].width+"px",t.style.height=o[u].scale*o[u].height+"px",t.style.transform="scale("+1/o[u].scale+", "+1/o[u].scale+")",e.style.width=y+"px",e.style.height=p+"px",l=0;u>l;l++)_+=o[l].scale*o[l].height;g=d*o[u].scale*o[u].width+d*(y-n[u].length*o[u].scale*o[u].width)/(n[u].length-1),e.style.left="-"+g+"px",e.style.top="-"+_+"px",this.getFrame=i,this.getContent=r,this.getMatrix=a,this.getWidth=c,this.getHeight=s}function d(t,e,n,o){function i(){y||(u||(u=!0,p=!0,s(d,{thr0w:{type:"sync",_id:e,lock:!0}})),s(d,{thr0w:{type:"sync",_id:e,message:n()}}))}function r(){y||(u=!1,s(d,{thr0w:{type:"sync",_id:e,unlock:!0}}))}function a(t){var i=t.message;if(void 0!==i&&t.source!==w){var r=i.thr0w;if(void 0!==r&&"sync"===r.type&&r._id===e){if(r.hello)return u&&s(d,{thr0w:{type:"sync",_id:e,lock:!0}}),void(p&&s(d,{thr0w:{type:"sync",_id:e,message:n()}}));if(!u)return r.lock&&!u?(p=!1,y=!0,void(_.style.visibility="visible")):r.unlock&&!u?(y=!1,void(_.style.visibility="hidden")):void o(r.message)}}}function c(){f.off("message",a)}if(void 0===t||"object"!=typeof t)throw 400;if(void 0===e||"string"!=typeof e)throw 400;if(void 0===n||"function"!=typeof n)throw 400;if(void 0===o||"function"!=typeof o)throw 400;var l,h,d=[],u=!1,y=!1,p=!1,g=t.getMatrix(),_=document.createElement("div");_.classList.add("thr0w_base_cover"),_.style.visibility="hidden",t.getFrame().appendChild(_);for(var v=0;v<g.length;v++)for(var m=0;m<g[v].length;m++)d.push(g[v][m]),w===g[v][m]&&(l=m,h=v);f.on("message",a),s(d,{thr0w:{type:"sync",_id:e,hello:!0}}),this.update=i,this.idle=r,this.destroy=c}var u,f=null,w=null,y={};y.setBase=t,y.addAdminTools=e,y.getChannel=n,y.login=o,y.logout=i,y.authenticated=r,y.thr0w=a,y.connect=c,y.thr0wChannel=s,y.Grid=l,y.FlexGrid=h,y.Sync=d,window.thr0w=y}();