!function(){"use strict";function t(t){d=t}function e(t,e,n){function c(t){function e(t){t||(l.style.display="none",d.style.display="block")}t.preventDefault();var n=l.querySelector("#thr0w_base_login__username").value,i=l.querySelector("#thr0w_base_login__password").value;n&&i&&o(n,i,e)}function s(t){function o(t){t||(d.style.display="none",e())}t.preventDefault();var i=parseInt(d.querySelector("#thr0w_base_connect__connect__channel").value);(!i||0>i)&&(i=0),a(i,o,n)}if(void 0===t||"object"!=typeof t)throw 400;if(void 0===e||"function"!=typeof e)throw 400;if(void 0===n||"function"!=typeof n)throw 400;var u,l=document.createElement("form"),d=document.createElement("div");l.id="thr0w_base_login",l.innerHTML=['<input id="thr0w_base_login__username" type="text" placeholder="Username">','<input id="thr0w_base_login__password" type="password" placeholder="Password">','<button type="submit">Login</button>'].join(""),d.id="thr0w_base_connect",d.innerHTML=['<form id="thr0w_base_connect__connect">','<input id="thr0w_base_connect__connect__channel" type="number" />','<button type="submit">Connect</button>',"</form>",'<button id="thr0w_base_connect__logout">Logout</button>'].join(""),t.appendChild(l),t.appendChild(d),u=d.querySelector("#thr0w_base_connect__connect"),r()?d.style.display="block":l.style.display="block",l.addEventListener("submit",c),d.querySelector("#thr0w_base_connect__logout").addEventListener("click",i),u.addEventListener("submit",s)}function n(){return h}function o(t,e,n){function o(){if(4===c.readyState){if(200===c.status){var t;try{t=JSON.parse(c.responseText).token}catch(e){return n(500)}return t?(window.localStorage.setItem("thr0w_token",t),n(null)):n(500)}return n(c.status?c.status:500)}}if(void 0===t||"string"!=typeof t)throw 400;if(void 0===e||"string"!=typeof e)throw 400;if(void 0===n||"function"!=typeof n)throw 400;var i=d+":3000/api/login",r="username="+t+"&password="+e,c=new XMLHttpRequest;c.open("POST",i,!0),c.setRequestHeader("Content-type","application/x-www-form-urlencoded"),c.onreadystatechange=o,c.send(r)}function i(){window.localStorage.removeItem("thr0w_token"),window.location.reload()}function r(){return null!==window.localStorage.getItem("thr0w_token")}function c(t,e){var n=d+":3000/api/thr0w",o=window.localStorage.getItem("thr0w_token"),i=new XMLHttpRequest;i.open("POST",n,!0),i.setRequestHeader("Authorization","bearer "+o),i.setRequestHeader("Content-type","application/json"),i.send(JSON.stringify({channels:t,message:e}))}function a(t,e,n){function o(){f.disconnect(),e(500)}function i(){function t(){window.location.reload()}window.clearTimeout(a),f.on("message",n),f.on("duplicate",t),e(null)}var c,a;if(!f){if(!r())throw 400;if(void 0===t||"number"!=typeof t)throw 400;if(void 0===e||"function"!=typeof e)throw 400;if(void 0===n||"function"!=typeof n)throw 400;h=t,c=window.localStorage.getItem("thr0w_token"),a=window.setTimeout(o,5e3),f=window.io(d+":3001"),f.on("authenticated",i),f.emit("authenticate",JSON.stringify({token:c,channel:h}))}}function s(t,e){if(!f)throw 400;f.emit("thr0w",JSON.stringify({channels:t,message:e}))}function u(t,e,n){function o(){return t}function i(){return e}function r(){return n}function c(){return e.offsetWidth}function a(){return e.offsetHeight}if(!f)throw 400;if(void 0===t||"object"!=typeof t)throw 400;if(void 0===e||"object"!=typeof e)throw 400;if(void 0===n||!Array.isArray(n))throw 400;for(var s,u,l=0;l<n.length;l++)for(var d=0;d<n[l].length;d++)h===n[l][d]&&(s=d,u=l);e.style.left="-"+s*t.clientWidth+"px",e.style.top="-"+u*t.clientHeight+"px",this.getFrame=o,this.getContent=i,this.getMatrix=r,this.getWidth=c,this.getHeight=a}function l(t,e,n,o){function i(){w||(d||(d=!0,p=!0,s(l,{thr0w:{type:"sync",_id:e,lock:!0}})),s(l,{thr0w:{type:"sync",_id:e,message:n()}}))}function r(){w||(d=!1,s(l,{thr0w:{type:"sync",_id:e,unlock:!0}}))}function c(t){var i=t.message;if(void 0!==i&&t.source!==h){var r=i.thr0w;if(void 0!==r&&"sync"===r.type&&r._id===e){if(r.hello)return d&&s(l,{thr0w:{type:"sync",_id:e,lock:!0}}),void(p&&s(l,{thr0w:{type:"sync",_id:e,message:n()}}));if(!d)return r.lock&&!d?(p=!1,void(w=!0)):r.unlock&&!d?void(w=!1):void o(r.message)}}}if(void 0===t||"object"!=typeof t)throw 400;if(void 0===e||"string"!=typeof e)throw 400;if(void 0===n||"function"!=typeof n)throw 400;if(void 0===o||"function"!=typeof o)throw 400;for(var a,u,l=[],d=!1,w=!1,p=!1,y=t.getMatrix(),_=0;_<y.length;_++)for(var g=0;g<y[_].length;g++)l.push(y[_][g]),h===y[_][g]&&(a=g,u=_);f.on("message",c),s(l,{thr0w:{type:"sync",_id:e,hello:!0}}),this.update=i,this.idle=r}var d,f=null,h=null,w={};w.setBase=t,w.addAdminTools=e,w.getChannel=n,w.login=o,w.logout=i,w.authenticated=r,w.thr0w=c,w.connect=a,w.thr0wChannel=s,w.Grid=u,w.Sync=l,window.thr0w=w}();