!function(){"use strict";function t(t){g=t}function e(t,e,n){function a(){function t(t){function n(t){27===t.keyCode&&w()}t?w():(window.localStorage.setItem("thr0w_channel",h),document.addEventListener("keydown",n),e())}s(h,t,n)}function c(){function e(){o()}function n(t){t.preventDefault(),i.style.display="none",h=parseInt(i.querySelector("#thr0w_base_connect__connect__channel").value),(!h||0>h)&&(h=0),a()}var i=document.createElement("div");i.id="thr0w_base_connect",i.innerHTML=['<form id="thr0w_base_connect__connect">','<input id="thr0w_base_connect__connect__channel" type="number" />','<button type="submit">Connect</button>',"</form>",'<button id="thr0w_base_connect__logout">Logout</button>'].join("\n"),i.querySelector("#thr0w_base_connect__logout").addEventListener("click",e),i.querySelector("#thr0w_base_connect__connect").addEventListener("submit",n),t.appendChild(i)}function l(){function e(t){function e(t){t||(n.style.display="none",c())}t.preventDefault();var o=n.querySelector("#thr0w_base_login__username").value,r=n.querySelector("#thr0w_base_login__password").value;o&&r&&i(o,r,e)}var n=document.createElement("form");n.id="thr0w_base_login",n.innerHTML=['<input id="thr0w_base_login__username" type="text" placeholder="Username">','<input id="thr0w_base_login__password" type="password" placeholder="Password">','<button type="submit">Login</button>'].join("\n"),n.addEventListener("submit",e),t.appendChild(n)}if(void 0===t||"object"!=typeof t)throw 400;if(void 0===e||"function"!=typeof e)throw 400;if(void 0===n||"function"!=typeof n)throw 400;var h=window.localStorage.getItem("thr0w_channel");null!==h?(h=parseInt(h),a()):r()?c():l()}function n(){return v}function i(t,e,n){function i(){if(4===a.readyState){if(200===a.status){var t;try{t=JSON.parse(a.responseText).token}catch(e){return n(500)}return t?(window.localStorage.setItem("thr0w_token",t),n(null)):n(500)}return n(a.status?a.status:500)}}if(void 0===t||"string"!=typeof t)throw 400;if(void 0===e||"string"!=typeof e)throw 400;if(void 0===n||"function"!=typeof n)throw 400;var o=g+":3000/api/login",r="username="+t+"&password="+e,a=new XMLHttpRequest;a.open("POST",o,!0),a.setRequestHeader("Content-type","application/x-www-form-urlencoded"),a.onreadystatechange=i,a.send(r)}function o(){window.localStorage.removeItem("thr0w_token"),w()}function r(){return null!==window.localStorage.getItem("thr0w_token")}function a(t,e){var n=g+":3000/api/thr0w",i=window.localStorage.getItem("thr0w_token"),o=new XMLHttpRequest;o.open("POST",n,!0),o.setRequestHeader("Authorization","bearer "+i),o.setRequestHeader("Content-type","application/json"),o.send(JSON.stringify({channels:t,message:e}))}function s(t,e,n){function i(){y.disconnect(),e(500)}function o(){function t(){w()}window.clearTimeout(s),y.on("message",n),y.on("duplicate",t),e(null)}var a,s;if(!y){if(!r())throw 400;if(void 0===t||"number"!=typeof t)throw 400;if(void 0===e||"function"!=typeof e)throw 400;if(void 0===n||"function"!=typeof n)throw 400;v=t,a=window.localStorage.getItem("thr0w_token"),s=window.setTimeout(i,5e3),y=p(g+":3001"),y.on("authenticated",o),y.emit("authenticate",JSON.stringify({token:a,channel:v}))}}function c(t){if(!r())throw 400;if(null===v)throw 400;if(void 0===t||"function"!=typeof t)throw 400;y.on("message",t)}function l(t){if(!r())throw 400;if(null===v)throw 400;if(void 0===t||"function"!=typeof t)throw 400;y.off("message",t)}function h(t,e){if(!y)throw 400;if(void 0===t||!Array.isArray(t))throw 400;0!==t.length&&y.emit("thr0w",JSON.stringify({channels:t,message:e}))}function f(t,e,n){function i(){return t}function o(){return e}function r(){return n}function a(){return e.clientWidth}function s(){return e.clientHeight}function c(){return 1}function l(e){if(void 0===e||!Array.isArray(e)||2!==e.length||void 0===e[0]||void 0===e[1]||"number"!=typeof e[0]||"number"!=typeof e[1])throw 400;return[e[0]+h*t.clientWidth,e[1]+f*t.clientHeight]}if(!y)throw 400;if(void 0===t||"object"!=typeof t)throw 400;if(void 0===e||"object"!=typeof e)throw 400;if(void 0===n||!Array.isArray(n))throw 400;for(var h=0,f=0,d=0;d<n.length;d++)for(var u=0;u<n[d].length;u++)v===n[d][u]&&(h=u,f=d);e.style.left="-"+h*t.clientWidth+"px",e.style.top="-"+f*t.clientHeight+"px",this.getFrame=i,this.getContent=o,this.getMatrix=r,this.getWidth=a,this.getHeight=s,this.getRowScale=c,this.frameXYToContentXY=l}function d(t,e,n,i){function o(){return t}function r(){return e}function a(){return n}function s(){return g}function c(){return p}function l(){return i[w].scale}function h(t){if(void 0===t||!Array.isArray(t)||2!==t.length||void 0===t[0]||void 0===t[1]||"number"!=typeof t[0]||"number"!=typeof t[1])throw 400;return[t[0]*i[w].scale+_,t[1]*i[w].scale+m]}if(!y)throw 400;if(void 0===t||"object"!=typeof t)throw 400;if(void 0===e||"object"!=typeof e)throw 400;if(void 0===n||!Array.isArray(n))throw 400;if(void 0===i||!Array.isArray(i))throw 400;var f,d,u=0,w=0,g=0,p=0,_=0,m=0;for(f=0;f<n.length;f++)for(i[f].spacing=i[f].spacing?i[f].spacing:0,i[f].scale=i[f].scale?i[f].scale:1,i[f].padding=i[f].padding?i[f].padding:0,i[f].margin=i[f].margin?i[f].margin:0,g=Math.max(i[f].scale*i[f].width*n[f].length+2*i[f].padding*i[f].scale+i[f].spacing*(n[f].length-1)*i[f].scale,g),p+=i[f].scale*i[f].height+i[f].scale*i[f].margin,d=0;d<n[f].length;d++)v===n[f][d]&&(u=d,w=f);for(t.style.width=i[w].scale*i[w].width+"px",t.style.height=i[w].scale*i[w].height+"px",t.style.transform="translate("+i[w].width*(1-i[w].scale)/2+"px,"+i[w].height*(1-i[w].scale)/2+"px) scale("+1/i[w].scale+", "+1/i[w].scale+")",e.style.width=g+"px",e.style.height=p+"px",f=0;w>f;f++)m+=i[f].scale*i[f].height+i[f].scale*i[f].margin;var b=i[w].padding*i[w].scale,S=u*i[w].scale*i[w].width,x=u*i[w].spacing*i[w].scale;_=b+S+x,e.style.left="-"+_+"px",e.style.top="-"+m+"px",this.getFrame=o,this.getContent=r,this.getMatrix=a,this.getWidth=s,this.getHeight=c,this.getRowScale=l,this.frameXYToContentXY=h}function u(t,e,n,i,o){function r(){w||(u||(u=!0,g=!0,o&&(_.style.visibility="visible"),h(d,{thr0w:{type:"sync",_id:e,lock:!0}})),h(d,{thr0w:{type:"sync",_id:e,message:n()}}))}function a(){w||(u=!1,o&&(_.style.visibility="hidden"),h(d,{thr0w:{type:"sync",_id:e,unlock:!0}}))}function s(t){var o=t.message;if(void 0!==o&&t.source!==v){var r=o.thr0w;if(void 0!==r&&"sync"===r.type&&r._id===e){if(r.hello)return u&&h(d,{thr0w:{type:"sync",_id:e,lock:!0}}),void(g&&h(d,{thr0w:{type:"sync",_id:e,message:n()}}));if(!u)return r.lock&&!u?(g=!1,w=!0,void(_.style.visibility="visible")):r.unlock&&!u?(w=!1,void(_.style.visibility="hidden")):void i(r.message)}}}function c(){m.removeChild(_),y.off("message",s)}if(void 0===t||"object"!=typeof t)throw 400;if(void 0===e||"string"!=typeof e)throw 400;if(void 0===n||"function"!=typeof n)throw 400;if(void 0===i||"function"!=typeof i)throw 400;if(void 0!==o&&"boolean"!=typeof o)throw 400;var l,f,d=[],u=!1,w=!1,g=!1,p=t.getMatrix(),_=document.createElement("div"),m=t.getFrame();_.id="thr0w_base_cover--"+e,_.classList.add("thr0w_base_cover"),_.style.visibility="hidden",m.appendChild(_);for(var b=0;b<p.length;b++)for(var S=0;S<p[b].length;S++)d.push(p[b][S]),v===p[b][S]&&(l=S,f=b);y.on("message",s),h(d,{thr0w:{type:"sync",_id:e,hello:!0}}),this.update=r,this.idle=a,this.destroy=c}function w(){window.localStorage.removeItem("thr0w_channel",v),window.location.reload()}var g,p=window.io,y=null,v=null,_={};_.setBase=t,_.addAdminTools=e,_.getChannel=n,_.login=i,_.logout=o,_.authenticated=r,_.thr0w=a,_.connect=s,_.onMessage=c,_.offMessage=l,_.thr0wChannel=h,_.Grid=f,_.FlexGrid=d,_.Sync=u,window.thr0w=_}();